basePath: /
host: localhost:3000
info:
  contact:
    name: API Support
    url: https://github.com/songquanpeng/one-api/issues
  description: One API 是一个统一的 AI 接口管理平台,支持多种 AI 服务提供商,包括 OpenAI、Anthropic、Google、Kling
    等
  license:
    name: MIT
    url: https://github.com/songquanpeng/one-api/blob/main/LICENSE
  termsOfService: https://github.com/songquanpeng/one-api
  title: One API
  version: "1.0"
paths:
  /kling/internal/callback:
    post:
      consumes:
      - application/json
      description: |-
        接收 Kling 平台的异步回调通知，自动更新视频生成任务状态和结果

        **注意事项**:
        - 此接口由 Kling 平台自动调用，无需手动请求
        - 不需要 Authorization 认证
        - 回调成功后会自动完成计费
        - 需要在系统配置中设置 ServerAddress 为公网可访问地址

        **回调时机**: 任务完成（成功或失败）时触发
      parameters:
      - description: Kling 回调数据（由 Kling 平台发送）
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 回调处理成功
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                type: string
            type: object
      summary: Kling 回调处理（内部接口）
      tags:
      - Kling视频生成
  /kling/v1/videos/{id}:
    get:
      consumes:
      - application/json
      description: |-
        根据任务 ID 查询视频生成任务的执行状态和结果

        **任务状态说明**:
        - submitted: 已提交，等待处理
        - processing: 处理中
        - succeed: 成功，可获取视频 URL
        - failed: 失败，查看 task_status_msg 了解原因

        **使用流程**: 创建任务后获得 task_id，使用此接口轮询查询，直到状态为 succeed 或 failed
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 任务ID（创建任务时返回的 task_id）
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务状态和结果，succeed 时包含视频 URL
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_result:
                    properties:
                      videos:
                        items:
                          properties:
                            duration:
                              type: string
                            id:
                              type: string
                            url:
                              type: string
                          type: object
                        type: array
                    type: object
                  task_status:
                    type: string
                  task_status_msg:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              code:
                type: integer
              error:
                type: string
              message:
                type: string
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "404":
          description: 任务不存在
          schema:
            properties:
              code:
                type: integer
              error:
                type: string
              message:
                type: string
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              code:
                type: integer
              error:
                type: string
              message:
                type: string
            type: object
      security:
      - Bearer: []
      summary: 查询 Kling 视频生成结果
      tags:
      - Kling视频生成
  /kling/v1/videos/advanced-lip-sync:
    post:
      consumes:
      - application/json
      description: |-
        为视频中的人脸添加对口型效果，使人物口型与音频同步

        **前置要求**: 必须先调用人脸识别接口获取 session_id 和 face_id

        **参数说明**:
        - model: 模型名称（必填）如 "kling-v1"
        - session_id: 人脸识别返回的会话 ID（必填）
        - face_choose: 人脸选择数组（必填）

        **face_choose 参数**:
        - face_id: 人脸 ID（必填，从人脸识别接口获取）
        - audio_id 或 sound_file: 音频 ID 或音频文件 URL（二选一必填）
        - sound_start_time: 音频开始时间，毫秒（必填）
        - sound_end_time: 音频结束时间，毫秒（必填）
        - sound_insert_time: 音频插入到视频的时间点，毫秒（必填）
        - sound_volume: 音频音量 0-1（可选，默认 1.0）
        - original_audio_volume: 原始音频音量 0-1（可选，默认 1.0）

        **计费说明**: 任务成功后通过回调结束时根据视频时长计费（后扣费）

        **使用流程**: 1. 人脸识别 → 2. 创建对口型任务 → 3. 查询任务结果或等待回调
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 对口型请求参数
        in: body
        name: request
        required: true
        schema:
          properties:
            face_choose:
              items:
                properties:
                  audio_id:
                    type: string
                  face_id:
                    type: string
                  original_audio_volume:
                    type: number
                  sound_end_time:
                    type: integer
                  sound_file:
                    type: string
                  sound_insert_time:
                    type: integer
                  sound_start_time:
                    type: integer
                  sound_volume:
                    type: number
                type: object
              type: array
            model:
              type: string
            session_id:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 对口型任务已创建，返回 task_id
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_status:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 高级对口型（异步接口）
      tags:
      - Kling视频生成
  /kling/v1/videos/identify-face:
    post:
      consumes:
      - application/json
      description: |-
        从视频中识别人脸信息，获取 session_id 和 face_id，用于高级对口型功能

        **参数说明**:
        - video_id: Kling 视频任务 ID（与 video_url 二选一）
        - video_url: 视频文件 URL（与 video_id 二选一）

        **返回数据**:
        - session_id: 会话 ID，用于对口型接口
        - face_data: 人脸数据数组，每个包含 face_id、face_image、start_time、end_time

        **计费说明**: 请求成功立即计费（按次）

        **使用场景**: 在使用高级对口型功能前，需要先调用此接口识别视频中的人脸
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 人脸识别请求参数（video_id 或 video_url 二选一）
        in: body
        name: request
        required: true
        schema:
          properties:
            video_id:
              type: string
            video_url:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 人脸识别成功，返回 session_id 和人脸数据
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  face_data:
                    items:
                      properties:
                        end_time:
                          type: integer
                        face_id:
                          type: string
                        face_image:
                          type: string
                        start_time:
                          type: integer
                      type: object
                    type: array
                  session_id:
                    type: string
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 参数错误（如未提供 video_id 或 video_url）
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 人脸识别（同步接口）
      tags:
      - Kling视频生成
  /kling/v1/videos/image2video:
    post:
      consumes:
      - application/json
      description: |-
        使用 Kling AI 生成视频，支持多种模式：
        - text2video: 文本描述生成视频
        - omni-video: 文本+图片混合生成，支持镜头控制
        - image2video: 单张或首尾帧图片生成视频
        - multi-image2video: 多张图片生成连贯视频

        **通用参数**: model(必填), mode(可选: std/pro), duration(可选: 5/10秒), aspect_ratio(可选: 16:9/9:16/1:1), cfg_scale(可选: 0-1), negative_prompt(可选)

        **text2video特有**: prompt(必填)
        **omni-video特有**: prompt(必填), image(可选-首帧), image_tail(可选-尾帧), camera_control(可选-镜头控制)
        **image2video特有**: image(必填-首帧), image_tail(可选-尾帧), prompt(可选)
        **multi-image2video特有**: image_list(必填-图片数组), prompt(必填)
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 视频生成请求参数（JSON格式，参数因端点而异）示例见文档
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 任务已创建，返回 task_id 用于查询结果
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_status:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 视频生成（多端点）
      tags:
      - Kling视频生成
  /kling/v1/videos/multi-image2video:
    post:
      consumes:
      - application/json
      description: |-
        使用 Kling AI 生成视频，支持多种模式：
        - text2video: 文本描述生成视频
        - omni-video: 文本+图片混合生成，支持镜头控制
        - image2video: 单张或首尾帧图片生成视频
        - multi-image2video: 多张图片生成连贯视频

        **通用参数**: model(必填), mode(可选: std/pro), duration(可选: 5/10秒), aspect_ratio(可选: 16:9/9:16/1:1), cfg_scale(可选: 0-1), negative_prompt(可选)

        **text2video特有**: prompt(必填)
        **omni-video特有**: prompt(必填), image(可选-首帧), image_tail(可选-尾帧), camera_control(可选-镜头控制)
        **image2video特有**: image(必填-首帧), image_tail(可选-尾帧), prompt(可选)
        **multi-image2video特有**: image_list(必填-图片数组), prompt(必填)
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 视频生成请求参数（JSON格式，参数因端点而异）示例见文档
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 任务已创建，返回 task_id 用于查询结果
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_status:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 视频生成（多端点）
      tags:
      - Kling视频生成
  /kling/v1/videos/omni-video:
    post:
      consumes:
      - application/json
      description: |-
        使用 Kling AI 生成视频，支持多种模式：
        - text2video: 文本描述生成视频
        - omni-video: 文本+图片混合生成，支持镜头控制
        - image2video: 单张或首尾帧图片生成视频
        - multi-image2video: 多张图片生成连贯视频

        **通用参数**: model(必填), mode(可选: std/pro), duration(可选: 5/10秒), aspect_ratio(可选: 16:9/9:16/1:1), cfg_scale(可选: 0-1), negative_prompt(可选)

        **text2video特有**: prompt(必填)
        **omni-video特有**: prompt(必填), image(可选-首帧), image_tail(可选-尾帧), camera_control(可选-镜头控制)
        **image2video特有**: image(必填-首帧), image_tail(可选-尾帧), prompt(可选)
        **multi-image2video特有**: image_list(必填-图片数组), prompt(必填)
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 视频生成请求参数（JSON格式，参数因端点而异）示例见文档
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 任务已创建，返回 task_id 用于查询结果
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_status:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 视频生成（多端点）
      tags:
      - Kling视频生成
  /kling/v1/videos/text2video:
    post:
      consumes:
      - application/json
      description: |-
        使用 Kling AI 生成视频，支持多种模式：
        - text2video: 文本描述生成视频
        - omni-video: 文本+图片混合生成，支持镜头控制
        - image2video: 单张或首尾帧图片生成视频
        - multi-image2video: 多张图片生成连贯视频

        **通用参数**: model(必填), mode(可选: std/pro), duration(可选: 5/10秒), aspect_ratio(可选: 16:9/9:16/1:1), cfg_scale(可选: 0-1), negative_prompt(可选)

        **text2video特有**: prompt(必填)
        **omni-video特有**: prompt(必填), image(可选-首帧), image_tail(可选-尾帧), camera_control(可选-镜头控制)
        **image2video特有**: image(必填-首帧), image_tail(可选-尾帧), prompt(可选)
        **multi-image2video特有**: image_list(必填-图片数组), prompt(必填)
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 视频生成请求参数（JSON格式，参数因端点而异）示例见文档
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 任务已创建，返回 task_id 用于查询结果
          schema:
            properties:
              code:
                type: integer
              data:
                properties:
                  created_at:
                    type: integer
                  task_id:
                    type: string
                  task_status:
                    type: string
                  updated_at:
                    type: integer
                type: object
              message:
                type: string
              request_id:
                type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  code:
                    type: string
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: Kling 视频生成（多端点）
      tags:
      - Kling视频生成
  /v1/video/generations:
    post:
      consumes:
      - application/json
      description: |-
        统一的视频生成接口，采用 OpenAI 兼容的请求格式，支持多种视频生成模型

        **支持的模型**: 根据系统配置的渠道支持不同的视频生成模型

        **请求格式**: 遵循 OpenAI API 格式规范

        **自动重试**: 支持智能重试机制，失败时自动切换可用渠道

        **计费方式**: 根据模型和视频时长计费
      parameters:
      - default: Bearer sk-xxxxx
        description: Bearer Token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 视频生成请求参数（格式因模型而异）
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 视频生成任务信息或结果
          schema:
            type: object
        "400":
          description: 请求参数错误
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "401":
          description: 认证失败
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "402":
          description: 余额不足
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
        "500":
          description: 服务器错误
          schema:
            properties:
              error:
                properties:
                  message:
                    type: string
                  type:
                    type: string
                type: object
            type: object
      security:
      - Bearer: []
      summary: 通用视频生成（OpenAI 兼容格式）
      tags:
      - 视频生成
schemes:
- http
- https
securityDefinitions:
  Bearer:
    description: '在请求头中添加 Bearer Token: Authorization: Bearer {token}'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
