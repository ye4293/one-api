# Tag è‡ªåŠ¨åŒ–è„šæœ¬ä½¿ç”¨è¯´æ˜

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªè‡ªåŠ¨æ‰“ tag çš„è„šæœ¬,ç”¨äºè§¦å‘ç”Ÿäº§ç¯å¢ƒçš„ Docker é•œåƒæ„å»ºã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### 1. `create_and_push_tag.sh` - å®Œæ•´ç‰ˆ (æ¨è)

åŠŸèƒ½å…¨é¢çš„è‡ªåŠ¨åŒ–è„šæœ¬,åŒ…å«å®Œæ•´çš„é”™è¯¯æ£€æŸ¥å’Œäº¤äº’æç¤ºã€‚

**ç‰¹æ€§:**
- âœ… æ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€
- âœ… è‡ªåŠ¨åˆ‡æ¢åˆ° main åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°ä»£ç 
- âœ… ç”Ÿæˆç¬¦åˆè§„èŒƒçš„ tag (alphaas-MMDDHHMM)
- âœ… æ¨é€ tag åˆ°è¿œç¨‹ä»“åº“
- âœ… è‡ªåŠ¨åˆ‡æ¢å›åŸåˆ†æ”¯
- âœ… æ”¯æŒæ¨¡æ‹Ÿè¿è¡Œ (--dry-run)
- âœ… æ”¯æŒè‡ªå®šä¹‰æ¶ˆæ¯ (--message)
- âœ… æ”¯æŒå¼ºåˆ¶è¦†ç›– (--force)

**ä½¿ç”¨æ–¹æ³•:**

```bash
# åŸºæœ¬ä½¿ç”¨
./scripts/create_and_push_tag.sh

# æ·»åŠ  tag æ¶ˆæ¯
./scripts/create_and_push_tag.sh --message "å‘å¸ƒæ–°åŠŸèƒ½: Kling API æ”¯æŒ"

# æ¨¡æ‹Ÿè¿è¡Œ (ä¸å®é™…æ¨é€)
./scripts/create_and_push_tag.sh --dry-run

# å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„ tag
./scripts/create_and_push_tag.sh --force

# æŸ¥çœ‹å¸®åŠ©
./scripts/create_and_push_tag.sh --help
```

### 2. `quick_tag.sh` - å¿«é€Ÿç‰ˆ

æç®€è„šæœ¬,é€‚åˆå¿«é€Ÿæ‰“ tagã€‚

**ä½¿ç”¨æ–¹æ³•:**

```bash
./scripts/quick_tag.sh
```

## ğŸ¯ Tag æ ¼å¼è¯´æ˜

ç”Ÿæˆçš„ tag æ ¼å¼ä¸º: `alphaas-MMDDHHMM`

- `alphaas-`: å›ºå®šå‰ç¼€
- `MM`: æœˆä»½ (01-12)
- `DD`: æ—¥æœŸ (01-31)
- `HH`: å°æ—¶ (00-23)
- `MM`: åˆ†é’Ÿ (00-59)

**ç¤ºä¾‹:**
- `alphaas-01221545` - 2026å¹´1æœˆ22æ—¥ 15:45
- `alphaas-12311159` - 2026å¹´12æœˆ31æ—¥ 23:59

## ğŸ”„ å·¥ä½œæµç¨‹

```
ç”¨æˆ·æ‰§è¡Œè„šæœ¬
    â†“
æ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€
    â†“
åˆ‡æ¢åˆ° main åˆ†æ”¯
    â†“
æ‹‰å–æœ€æ–°ä»£ç  (git pull)
    â†“
ç”Ÿæˆ tag (alphaas-MMDDHHMM)
    â†“
æ¨é€ tag åˆ°è¿œç¨‹
    â†“
è§¦å‘ GitHub Actions
    â†“
æ„å»º Docker é•œåƒ
    â†“
æ¨é€åˆ° Docker Hub å’Œ GHCR
    â†“
è‡ªåŠ¨æ¸…ç†æ—§é•œåƒ (ä¿ç•™æœ€æ–°5ä¸ª)
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ‰§è¡Œå‰ç¡®è®¤

- ç¡®ä¿æœ¬åœ° main åˆ†æ”¯ä¸è¿œç¨‹åŒæ­¥
- ç¡®è®¤å½“å‰ä»£ç å·²é€šè¿‡æµ‹è¯•
- æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„é‡è¦æ›´æ”¹

### 2. Tag å†²çªå¤„ç†

å¦‚æœåŒä¸€åˆ†é’Ÿå†…æ‰§è¡Œå¤šæ¬¡,ä¼šäº§ç”Ÿç›¸åŒçš„ tag åç§°:

```bash
# æ–¹å¼ 1: ç­‰å¾…1åˆ†é’Ÿåé‡æ–°æ‰§è¡Œ
sleep 60 && ./scripts/create_and_push_tag.sh

# æ–¹å¼ 2: ä½¿ç”¨ --force å¼ºåˆ¶è¦†ç›–
./scripts/create_and_push_tag.sh --force

# æ–¹å¼ 3: æ‰‹åŠ¨åˆ é™¤å†²çªçš„ tag
git tag -d alphaas-01221545
git push origin :refs/tags/alphaas-01221545
```

### 3. æŸ¥çœ‹å’Œç®¡ç† Tag

```bash
# æŸ¥çœ‹æ‰€æœ‰ alphaas- å¼€å¤´çš„ tag (æŒ‰æ—¶é—´å€’åº)
git tag --sort=-creatordate | grep "^alphaas-"

# æŸ¥çœ‹æœ€è¿‘ 5 ä¸ª tag
git tag --sort=-creatordate | grep "^alphaas-" | head -5

# æŸ¥çœ‹æŒ‡å®š tag çš„è¯¦ç»†ä¿¡æ¯
git show alphaas-01221545

# åˆ é™¤æœ¬åœ° tag
git tag -d alphaas-01221545

# åˆ é™¤è¿œç¨‹ tag
git push origin :refs/tags/alphaas-01221545

# é‡æ–°æ¨é€ tag
git push origin alphaas-01221545
```

### 4. å›æ»šæ“ä½œ

å¦‚æœ tag æ‰“é”™äº†éœ€è¦å›æ»š:

```bash
# 1. åˆ é™¤æœ¬åœ° tag
git tag -d alphaas-01221545

# 2. åˆ é™¤è¿œç¨‹ tag (ä¼šåœæ­¢ GitHub Actions)
git push origin :refs/tags/alphaas-01221545

# 3. é‡æ–°æ‰“æ­£ç¡®çš„ tag
./scripts/create_and_push_tag.sh
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: å·¥ä½œåŒºæœ‰æœªæäº¤çš„æ›´æ”¹

```bash
é”™è¯¯: å·¥ä½œåŒºæœ‰æœªæäº¤çš„æ›´æ”¹
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é€‰é¡¹ 1: æäº¤æ›´æ”¹
git add .
git commit -m "fix: ä¿®å¤é—®é¢˜"

# é€‰é¡¹ 2: æš‚å­˜æ›´æ”¹
git stash
./scripts/create_and_push_tag.sh
git stash pop

# é€‰é¡¹ 3: å¼ºåˆ¶ç»§ç»­ (ä¸æ¨è)
# è„šæœ¬ä¼šæç¤ºæ˜¯å¦ç»§ç»­,è¾“å…¥ y
```

### é—®é¢˜ 2: æ‹‰å–ä»£ç å¤±è´¥

```bash
é”™è¯¯: æ‹‰å–ä»£ç å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping github.com

# æ£€æŸ¥è¿œç¨‹ä»“åº“é…ç½®
git remote -v

# æ‰‹åŠ¨æ‹‰å–
git pull origin main

# å¦‚æœæœ‰å†²çª,è§£å†³åé‡æ–°æ‰§è¡Œè„šæœ¬
```

### é—®é¢˜ 3: Tag å·²å­˜åœ¨

```bash
é”™è¯¯: tag alphaas-01221545 å·²å­˜åœ¨
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é€‰é¡¹ 1: ç­‰å¾…1åˆ†é’Ÿé‡è¯•
sleep 60 && ./scripts/create_and_push_tag.sh

# é€‰é¡¹ 2: ä½¿ç”¨ --force å¼ºåˆ¶è¦†ç›–
./scripts/create_and_push_tag.sh --force
```

### é—®é¢˜ 4: æ¨é€ tag å¤±è´¥

```bash
é”™è¯¯: æ¨é€ tag å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥ GitHub è®¤è¯
git push origin main

# æ‰‹åŠ¨æ¨é€ tag
git push origin alphaas-01221545

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
GIT_TRACE=1 git push origin alphaas-01221545
```

## ğŸ“Š ç›‘æ§é•œåƒæ„å»º

Tag æ¨é€åä¼šè‡ªåŠ¨è§¦å‘ GitHub Actions å·¥ä½œæµ:

1. **æŸ¥çœ‹å·¥ä½œæµçŠ¶æ€**
   ```bash
   # åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
   https://github.com/ye4293/one-api/actions
   ```

2. **ç›‘æ§æ„å»ºæ—¥å¿—**
   - è¿›å…¥å¯¹åº”çš„å·¥ä½œæµè¿è¡Œ
   - æŸ¥çœ‹ "Build and push Docker images" æ­¥éª¤
   - ç¡®è®¤é•œåƒæˆåŠŸæ¨é€

3. **éªŒè¯é•œåƒ**
   ```bash
   # æŸ¥çœ‹ Docker Hub
   https://hub.docker.com/r/ye4293xx7/one-api/tags

   # æ‹‰å–é•œåƒæµ‹è¯•
   docker pull ye4293xx7/one-api:alphaas-01221545
   docker pull ye4293xx7/one-api:latest
   ```

## ğŸš€ æœ€ä½³å®è·µ

1. **æ‰“ Tag å‰çš„æ£€æŸ¥æ¸…å•**
   - [ ] ä»£ç å·²åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
   - [ ] æ— æœªæäº¤çš„å…³é”®æ›´æ”¹
   - [ ] æœ¬åœ° main åˆ†æ”¯æ˜¯æœ€æ–°çš„

2. **ä½¿ç”¨å»ºè®®**
   - æµ‹è¯•ç¯å¢ƒ: ç›´æ¥ push åˆ° dev åˆ†æ”¯
   - ç”Ÿäº§ç¯å¢ƒ: ä½¿ç”¨æ­¤è„šæœ¬æ‰“ tag
   - é‡å¤§æ›´æ–°: æ·»åŠ  tag æ¶ˆæ¯ (--message)

3. **å‘½åçº¦å®š**
   - è‡ªåŠ¨ç”Ÿæˆçš„ tag: `alphaas-MMDDHHMM`
   - ä¸è¦æ‰‹åŠ¨åˆ›å»º `alphaas-` å¼€å¤´çš„ tag
   - ä¿æŒæ ¼å¼ç»Ÿä¸€ä¾¿äºè‡ªåŠ¨åŒ–ç®¡ç†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions å·¥ä½œæµé…ç½®](../.github/workflows/docker-image-amd64.yml)
- [Docker é•œåƒæ„å»ºè¯´æ˜](../docs/DOCKER_BUILD.md)
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—](../docs/DEPLOYMENT.md)

## ğŸ†˜ éœ€è¦å¸®åŠ©?

å¦‚æœé‡åˆ°é—®é¢˜,è¯·:
1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤) éƒ¨åˆ†
2. æ£€æŸ¥ GitHub Actions æ—¥å¿—
3. è”ç³»å¼€å‘å›¢é˜Ÿ
