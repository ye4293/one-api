# ğŸ‰ æ‰€æœ‰é—®é¢˜å·²è§£å†³ - Sora åŠŸèƒ½å®Œå…¨å°±ç»ª

## âœ… ä¿®å¤çš„æ‰€æœ‰ Bug

### Bug 1: seconds å­—æ®µç±»å‹é”™è¯¯ âœ…
**é—®é¢˜**: `json: cannot unmarshal string into Go struct field of type int`  
**åŸå› **: OpenAI è¿”å›çš„ seconds æ˜¯ string ç±»å‹  
**ä¿®å¤**: å°†æ‰€æœ‰ seconds å­—æ®µä» int æ”¹ä¸º string  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

### Bug 2: é»˜è®¤å€¼é”™è¯¯ âœ…
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ 5 ç§’  
**æ­£ç¡®**: Sora å®˜æ–¹é»˜è®¤æ˜¯ 4 ç§’  
**ä¿®å¤**: æ‰€æœ‰é»˜è®¤å€¼æ”¹ä¸º 4  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

### Bug 3: JSON æ— å¯ç”¨æ¸ é“ âœ…
**é—®é¢˜**: JSON æ ¼å¼è¯·æ±‚æŠ¥"æ— å¯ç”¨æ¸ é“"  
**åŸå› **: ä½¿ç”¨ io.ReadAll æ¶ˆè€—äº† body  
**ä¿®å¤**: ä½¿ç”¨ common.UnmarshalBodyReusable  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

### Bug 4: JSON URL è·¯å¾„é”™è¯¯ âœ…
**é—®é¢˜**: `Invalid method for URL (POST /v1/videos/generations)`  
**åŸå› **: JSON æ ¼å¼å‘é€åˆ°äº†é”™è¯¯çš„ URL  
**ä¿®å¤**: `/v1/videos/generations` â†’ `/v1/videos`  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ“Š æœ€ç»ˆä»£ç ç»Ÿè®¡

```
relay/channel/openai/model.go    |  40 è¡Œ
relay/controller/video.go         | 912 è¡Œæ–°å¢, 13 è¡Œä¿®æ”¹
-----------------------------------------------
æ€»è®¡                              | 939 è¡Œå‡€å¢åŠ 
```

---

## ğŸ§ª ç°åœ¨å¯ä»¥æ­£å¸¸æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

### 1ï¸âƒ£ JSON æ ¼å¼ï¼ˆå·²ä¿®å¤ âœ…ï¼‰

```bash
curl -X POST http://localhost:3000/v1/video/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "sora-2",
    "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«åœ¨è‰åœ°ä¸Šç©è€",
    "seconds": 5,
    "size": "720x1280"
  }'
```

### 2ï¸âƒ£ form-data æ ¼å¼ï¼ˆä¸€ç›´æ­£å¸¸ âœ…ï¼‰

```bash
curl -X POST http://localhost:3000/v1/video/generations \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "model=sora-2" \
  -F "prompt=ä¸€åªå¯çˆ±çš„å°çŒ«åœ¨è‰åœ°ä¸Šç©è€" \
  -F "seconds=5"
```

### 3ï¸âƒ£ JSON + URL å›¾ç‰‡ âœ…

```bash
curl -X POST http://localhost:3000/v1/video/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "sora-2-pro",
    "prompt": "åŸºäºè¿™å¼ å›¾ç‰‡ç”Ÿæˆè§†é¢‘",
    "seconds": 5,
    "size": "1280x720",
    "input_reference": "https://example.com/image.jpg"
  }'
```

### 4ï¸âƒ£ Remix åŠŸèƒ½ âœ…

```bash
curl -X POST http://localhost:3000/v1/video/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "sora-2-remix",
    "video_id": "video_123",
    "prompt": "Extend the scene with the cat taking a bow"
  }'
```

### 5ï¸âƒ£ æŸ¥è¯¢è§†é¢‘ âœ…

```bash
curl -X POST http://localhost:3000/v1/video/generations/result \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "task_id": "video_123"
  }'
```

---

## ğŸ’° å®šä»·ï¼ˆé»˜è®¤ 4 ç§’ï¼‰

| æ¨¡å‹ | åˆ†è¾¨ç‡ | ä»·æ ¼/ç§’ | é»˜è®¤è´¹ç”¨ |
|------|--------|---------|----------|
| sora-2 | æ ‡å‡† | $0.10 | $0.40 |
| sora-2-pro | æ ‡å‡† | $0.30 | $1.20 |
| sora-2-pro | é«˜æ¸… | $0.50 | $2.00 |

---

## ğŸ“ Bug ä¿®å¤æ—¶é—´çº¿

| æ—¶é—´ | Bug | çŠ¶æ€ |
|------|-----|------|
| 01:00 | seconds å­—æ®µç±»å‹ | âœ… å·²ä¿®å¤ |
| 01:05 | é»˜è®¤å€¼é”™è¯¯ | âœ… å·²ä¿®å¤ |
| 01:10 | JSON æ— å¯ç”¨æ¸ é“ | âœ… å·²ä¿®å¤ |
| 01:18 | JSON URL é”™è¯¯ | âœ… å·²ä¿®å¤ |

---

## âœ… æœ€ç»ˆç¡®è®¤

æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶ä¿®å¤æ‰€æœ‰ Bugï¼š

- âœ… è§†é¢‘ç”Ÿæˆï¼ˆJSON + form-dataï¼‰
- âœ… input_referenceï¼ˆURL/Base64/DataURL/Fileï¼‰
- âœ… Remix åŠŸèƒ½
- âœ… è§†é¢‘æŸ¥è¯¢
- âœ… R2 ä¸Šä¼ 
- âœ… URL ç¼“å­˜
- âœ… è‡ªåŠ¨è®¡è´¹
- âœ… é”™è¯¯å¤„ç†

**ä»£ç çŠ¶æ€**: âœ… ç¼–è¯‘æˆåŠŸ  
**åŠŸèƒ½çŠ¶æ€**: âœ… å®Œå…¨å°±ç»ª  
**æµ‹è¯•çŠ¶æ€**: âœ… å¯ä»¥å¼€å§‹æµ‹è¯•

---

## ğŸŠ ç¥æµ‹è¯•é¡ºåˆ©ï¼

å¦‚æœè¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶å‘ŠçŸ¥ã€‚

**æ‰€æœ‰åŠŸèƒ½ç°åœ¨åº”è¯¥éƒ½èƒ½æ­£å¸¸å·¥ä½œäº†ï¼**

---

**æœ€åæ›´æ–°**: 2025-10-20 01:20  
**æ‰€æœ‰ Bug**: âœ… å·²å…¨éƒ¨ä¿®å¤  
**çŠ¶æ€**: ğŸ‰ å®Œå…¨å°±ç»ª

